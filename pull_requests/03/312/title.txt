More work on typestate. Sketched out code for computing and checking pres