Further work on typestate. Handles expr_rec and expr_assign now.