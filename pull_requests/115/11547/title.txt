Removed redundant code, improve performance