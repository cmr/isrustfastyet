Improved pattern-match code and explanation.