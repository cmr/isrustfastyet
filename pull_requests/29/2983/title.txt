Allow io::reader to use preallocated buffers, plus other misc changes