Enhance auto_encode to take number of struct fields