Range checking and miscellaneous fixes tin time library