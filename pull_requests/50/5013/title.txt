core: a few core::os fns ported to rust + ptr::array_each