Change Decoder::read_option to allow returning arbitrary types; inline some malloc wrapper fns