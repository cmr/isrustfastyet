rustpkg: Factor out tests; use a condition instead of returning an option