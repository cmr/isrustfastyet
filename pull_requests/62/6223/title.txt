Implement the new for-loop protocol