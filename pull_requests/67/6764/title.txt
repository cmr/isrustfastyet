Fix #3961 : use char range methods (not byte offsets) to detect whitespace