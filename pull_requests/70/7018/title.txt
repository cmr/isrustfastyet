Fix #7017, add test