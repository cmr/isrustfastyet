Upgrades to sync::rwlock - fix a race and improve performance