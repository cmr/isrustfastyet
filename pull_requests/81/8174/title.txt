Sha1 and Sha2 cleanups & optimizations, take 2