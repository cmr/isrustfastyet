Consolidate local_data implementations, and cleanup