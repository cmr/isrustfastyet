debuginfo: Some refactoring and fix for #8670