Refactor the logging system for fewer allocations